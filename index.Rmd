---
title: "A3: SPL Library Checkouts"
output: html_document
---
```{r, echo = FALSE}
jg_df <- read.csv("John_Green_Checkouts.csv", stringsAsFactors = FALSE)
```

### Introduction
Using the Seattle Public Library data, I chose to analyze the books by John Green that were checked out in Seattle. I chose this author because he was very popular when I was younger, and I wanted to understand how popular his books have been recently. I was also curious about whether certain factors related to the level of popularity of his books. This leads me to my main research question:

- *How popular has John Green's books been from 2007 to 2023?*

In order to do so, I will focus on the **Checkouts**, **Title**, **Subjects**, **CheckoutYear**, **CheckoutMonth**, **Publisher**, and **MaterialType** when calculating summary statistics. In addition to these variables, I will also be using the **Publisher Year** when creating data visualizations to analyze the following trends:

MAY NEED TO FIX THESE!!!! :
- *How have the most checked out books written by John Green changed overtime?*
- *How does the number of John Green's books that were published correlate to the number of John Green's books that were checked out overtime?*
- *How has the popularity of John Green's books' genres changed overtime?*

### Summary Information
```{r, echo = FALSE, warning = FALSE, message = FALSE, code = readLines("summary.R")}
```
In order to assess John Green's popularity throughout the years and factors that may be associated with his popularity, I calculated summary statistics that use the variables specified in the introduction. First, I wanted to know which piece of work written by John Green was the most popular, which I found by pulling the title of the item with the most amount of checkouts. I found that the title of the item written by John Green with the most number of checkouts in Seattle from 2007 to 2023 was `r item_most_checkouts`. I purposefully did not combine items with the same title written in a format because these differences in format are due to differences in the item's language, material type, or publisher which can potentially impact how often an item is checked out. (For instance, John Green's book called "An Abundance of Katherines" can also be found in the dataframe under the title "An Abundance of Katherines (Unabridged)", "El teorema Katherine: An Abundance of Katherines", or "El teorema Katherine". These differences occurred because the material type is an audiobook instead of an ebook, written in Spanish, or published by a different company.) 

Then, I wanted to understand if other factors impacted John Green's popularity in the Seattle Public Library. I did so by calculating how often an item was checked out based on factors such as the subjects of the book, the date of the check out, the publishing company, and the medium of the item. First, I found the genres of the item that was most checked out by calculating the number of checkouts per unique group of subjects. The item with the most checkouts has the following group of subjects: `r subjects_most_checkouts`. 

Regarding the time period when John Green's books were most popular, I calculated the month and year when the most John Green books were checked out to be `r date_most_checkouts`. To see if annual holidays or events impacted the popularity of John Green's books, I calculated the month (regardless of year) with the most amount of checkouts. I found this month to be `r month_highest_checkouts`.

As for the publishing company, I found that the most checkouts of books written by John Green were published by `r publish_cmpny_most_checkouts`. Finally, John Green's book checkouts were least checked out as an `r medium_least_checkouts`.

### The Dataset

> Who collected/published the data?  

- The Seattle Public Library created and published the data. (My custom dataframe uses this data, but it is filtered to only include checkout items written by the American author "John Green".)
  
> What are the parameters of the data (dates, number of checkouts, kinds of books, etc.)?

- The parameters of the data are listed below:
  - UsageClass (whether the check out was digital or physical)
  - CheckoutType (the vendor tool used for the check out)
  - MaterialType (the medium of the check out)
  - CheckoutYear
  - CheckoutMonth    
  - Checkouts (number of check outs of the item)
  - Title (of the item checked out)
  - ISBN
  - Creator
  - Subjects (a list of genres of the item)
  - Publisher
  - PublicationYear
  
> How was the data collected or generated?  

- The digital checkout data was collected through the Seattle Public Library's vendors (who are Overdrive, hoopla, Freegal, and RBDigital). Data on physical checkouts was collected from the Legrady artwork data archives from 2005 to 2016 and from the Horizon ILS since 2016.

> Why was the data collected?  

- According to Seattle's Open Data website, data is published by the city's departments and put into their Open Data program. This Open Data program was created so that the data collected by Seattle was easily accessible to the public. They wanted the availability of the data to increase Seattle's quality of life and promote a supportive and beneficial community to its residents. The program wanted the data to be used towards its goal of constant self-improvement.

> What, if any, ethical questions do you need to consider when working with this data? 

- One ethical question to consider is how the Seattle Public Library alerted its users that their data was being collected. Although the data remains anonymous, users of the library may not be comfortable with their check out information being collected as the items' subjects can read into the users' personal interests or political beliefs. Considering how many websites force a user to accept their terms and conditions in order to use the website, the library may follow a similar policy for users to check out items. This means that for users who require the use of the library's items, they would be forced to share their data in order to access the library's resources.

> What are possible limitations or problems with this data?

- One limitation of the data is that it does not record renewal check outs and only records the initial check out. This means that the data is likely to have underestimated the number of total check outs per month as it is common for users to extend their time limit. 

- Another problem of the data is that it is very messy due to its variation in sources. The different sources used to collect the data means that different types of information may have been collected or different methods were used to do so. For example, the source for the physical checkouts changed during 2016, so some entries have blank fields meaning the data is inconsistent depending on what time frame is being viewed. Furthermore, the original dataset is messy as some of the entries use unreadable characters and the format of data entries differs. This can be seen when looking at the "PublicationYear" column which can make filtering for a certain data value difficult. This also includes book titles that are written in English or Spanish or written with different capitalized letters (such as "unabridged" versus "Unabridged").

- A third problem relates to the Subjects column. The subject of each entry is a string of subjects. This means that each subject entry does not pertain to one unique subject. For example, when looking at the subjects for the book titled "An Abundance of Katherines" and comparing it to "Paper Towns", the entire subject entry itself is different. However, after taking a closer look at each subject in the list, we are able to find that both books share Young Adult Fiction as a subject. 

- Lastly, in my filtered dataset, the creator is filtered to "John Green", but this doesn't mean that all creators are the same person. This means that creators who share the same name are included in this dataset, so I need to further clean the data to only include items created by the American author John Green. 

- In order to limit these issues in my custom dataframe, I first went filtered the "Title" column in alphabetical order to check if each item was written by the American author John Green or not. If the item was written by a different author, I deleted the entry. Next, I viewed the titles to eliminate any errors due to capitalization errors in the word "unabridged". If the "UsageClass", "CheckoutType", "MaterialType", "Publisher", and "PublicationYear" were the same, then I changed any lowercase "unabridged" words to "Unabridged". As explained in the summary information section, I did not combine the same works together (such as combining all works of "The Fault in Our Stars" because the different in title entries were due to a difference in matieral type, publisher, or language. Lastly, I did not use the ISBN column when using my custom dataset because it contained a significantly large amount of "NA" values. 

THINGS TO THINK ABOUT WHEN USING DATA:
- Subjects, need to use string detect
- Title - format not same
- Not all same John Green
- The dataset is each item checked out per month, so repeated titles

### First Trends Over Time Chart
```{r, echo = FALSE, warning = FALSE, code = readLines("chart1.R")}
```

I included a chart that shows the trends of the number of checkouts of the English ebooks written by John Green between 2008 and 2023. I wanted to visualize how popular John Green's books were overtime, so I decided to do so by analyzing the number of checkouts for each ebook by month and year. I chose to only visualize ebooks because this material was more common than the audiobooks, and there were only ebooks and audiobooks in list of materials. I also only chose the English versions because I didn't want to combine the same titles in English and Spanish in case language plays a factor in popularity. The chart reveals that "The Fault in Our Stars" had the greatest peak in checkouts around 2014. Although not as great, "Turtles All the Way Down" also experienced significant peak in checkouts from 2016 to 2020. The annual total number of checkouts for John Green's English ebooks has never exceeded 250 checkouts. Also, seeing as how the peaks have declined overtime, John Green's English ebooks don't seem to be as popular as they were in the early to mid 2010's. 

### Second Trends Over Time Chart
```{r, echo = FALSE, code = readLines("chart2.R")}
```

This line plot shows how the material of the checkout (for works by John Green) have changed over time. I wanted to understand the popularity of each material type throughout the years as the material of a book is a potential factor to an author's popularity. For instance, if an author publishes more works as a physical book when more readers prefer ebooks, then the author's popularity could decrease. This line plot shows that the number of ebook Checkouts has been greater than the number of audiobook checkouts on average for John Green's works. However, it also shows the general decline in ebook checkouts and the rise in audiobook checkouts. This suggests that more customers are interested in audiobooks, so John Green may want to consider in publishing more audiobook stories to increase his popularity and success. 


### Your Choice

The last chart is up to you. It could be a line plot, scatter plot, histogram, bar plot, stacked bar plot, and more. Here are some requirements to help guide your design:

- You must have clear x and y axis labels
- The chart needs a clear title 
- You need a legend for your different line colors and a clear legend title

Here's an example of how to run an R script inside an RMarkdown file:



